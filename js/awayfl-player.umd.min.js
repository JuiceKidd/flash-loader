(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("@awayfl/swf-loader"),require("@awayjs/view"),require("@awayfl/playerglobal"),require("@awayfl/avm1"),require("@awayfl/avm2")):typeof define==="function"&&define.amd?define(["exports","@awayfl/swf-loader","@awayjs/view","@awayfl/playerglobal","@awayfl/avm1","@awayfl/avm2"],t):t(e.AwayflPlayer={},e.AwayflSwfLoader,e.AwayjsView,e.AwayflPlayerglobal,e.AwayflAvm1,e.AwayflAvm2)})(this,function(e,n,o,i,a,s){"use strict";var l=function(e,t){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return l(e,t)};function t(e,t){l(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function d(e){var t=Object.assign({},e);Object.keys(t).forEach(function(e){if(typeof t[e]==="object"){t[e]=d(t[e])}else if(typeof t[e]==="function"){t[e]=t[e].toString()}});return t}var p=["id","visible","index","assetType:type","name"];var f=function(){function e(e){this.player=e;n.registerDebugMethod(this._dirObjectByIds.bind(this),{name:"dirObjectByIds",description:"Export selected object to console",declaration:[{name:"ids",type:"object"}]});n.registerDebugMethod(this._applyPropsByIds.bind(this),{name:"applyPropsByIds",description:"Apply propertyes by node ids",declaration:[{name:"ids",type:"object"},{name:"object",type:"object"}]});n.registerDebugMethod(this._removeObjectByIds.bind(this),{name:"removeObjectByIds",description:"Remove object from sceen tree",declaration:[{name:"ids",type:"object"}]});n.registerDebugMethod(this._getInfo.bind(this),{name:"getInfo",description:"Get file info for app",declaration:[{name:"return",type:"object"}]});n.registerDebugMethod(this._getSceneTree.bind(this),{name:"getNodeTree",description:"Get sceen tree of app",declaration:[{name:"return",type:"object"},{name:"flat",type:"boolean"},{name:"from",type:"number"},{name:"rect",type:"object"}]});n.registerDebugMethod(this._getStageCanvas.bind(this),{name:"getStageCanvas",description:"Get canvas attahed to stage",declaration:[]});window._AWAY_DEBUG_PLAYER_=this}e.prototype.onAvmInit=function(e){window._AWAY_DEBUG_STORAGE=e===1?a.SharedObjectDebug:i.SharedObjectDebug};e.prototype._selectNode=function(e){var r=this.player.root;var t=function(t){r=r._children.find(function(e){return e.id===t});if(!r){return"break"}};for(var n=0,i=e;n<i.length;n++){var a=i[n];var o=t(a);if(o==="break")break}if(!r){throw new Error("Node not found")}return r};e.prototype._getStageCanvas=function(){return this.player.view.stage.container};e.prototype._dirObjectByIds=function(e){console.dir(this._selectNode(e))};e.prototype._getNodeBounds=function(e){var t=this.player.view;var r=t.stage;var n=o.PickGroup.getInstance(t).getBoundsPicker(e.partition).getBoxBounds(this.player.root);if(!n)return null;var i=t.width/this.player.stageWidth;var a=t.height/this.player.stageHeight;return{x:n.x*i,y:n.y*a,width:n.width*i,height:n.height*a}};e.prototype._traverse=function(e,t,r,n){if(t===void 0){t=false}if(r===void 0){r=false}if(n===void 0){n=false}var i={parentId:e.parent?e.parent.id:-1,children:null,rect:null};for(var a=0,o=p;a<o.length;a++){var s=o[a];var l=s.split(":");if(l.length>1){i[l[1]]=e[l[0]]}else{i[s]=e[s]}}i["globalVisible"]=e.parent?e.parent.visible&&e.visible:e.visible;if(r){i.rect=this._getNodeBounds(e)}if(t){i.children=[];for(var f=0,c=e._children;f<c.length;f++){var d=c[f];if(n&&d.visible||!n){i.children.push(this._traverse(d,t,r,n))}}}return i};e.prototype._removeObjectByIds=function(e){var t=this._selectNode(e);t.parent.removeChild(t)};e.prototype._applyPropsByIds=function(e,t){var r=this._selectNode(e);Object.assign(r,t)};e.prototype._getSceneTree=function(e,t,r){if(typeof e!=="object"){e={flat:e||false,from:t||0,rect:r||false,visibleOnly:false}}var n=e.flat,i=n===void 0?false:n,a=e.from,o=e.rect,s=o===void 0?false:o,l=e.visibleOnly,f=l===void 0?false:l;var c=[];var d=this.player.root._children.slice();while(true){var p=d.pop();if(!p){break}c.push(this._traverse(p,!i,s,f));if(i){d.push.apply(d,p._children.reverse().filter(function(e){return e.visible&&f||!f}))}}return c};e.prototype._getInfo=function(){var e;var t=this.player;var r=t._avmHandler.avmVersion;var n=t._swfFile,i=n.swfVersion,a=n.fpVersion,o=n.frameCount,s=n.frameRate,l=n.compression,f=n.bytesTotal;var c=(e=t._gameConfig.binary.filter(function(e){var t=e.resourceType;return t==="GAME"})[0])===null||e===void 0?void 0:e.path;if(c&&c.indexOf("?")>-1){c=c.substring(0,c.indexOf("?"))}return{file:{name:t._gameConfig.title,path:c,size:f},runtime:{swfVersion:i,fpVersion:a,frameCount:o,frameRate:s,compression:l,avm:r},config:d(t._gameConfig)}};return e}();var r=function(r){t(e,r);function e(e){var t=r.call(this,e)||this;t.registerAVMStageHandler(new a.AVM1Handler);t.registerAVMStageHandler(new s.AVM2Handler(new i.PlayerGlobal));t.addEventListener(n.AVMEvent.AVM_COMPLETE,function(e){return t.onAVMAvailable(e)});t._debug=new f(t);return t}e.prototype.onAVMAvailable=function(e){if(this._debug){this._debug.onAvmInit(e.avmVersion==="AVM1"?1:2)}};return e}(n.AVMStage);var c=function(r){t(e,r);function e(e){var t=r.call(this,e)||this;t.registerAVMStageHandler(new a.AVM1Handler);return t}return e}(n.AVMStage);var u=function(r){t(e,r);function e(e){var t=r.call(this,e)||this;t.registerAVMStageHandler(new s.AVM2Handler(new i.PlayerGlobal));return t}return e}(n.AVMStage);console.debug("AwayFL - AwayFL-Player - 0.2.20");e.AVMPlayer=r;e.AVM1Player=c;e.AVM2Player=u;Object.defineProperty(e,"__esModule",{value:true})});